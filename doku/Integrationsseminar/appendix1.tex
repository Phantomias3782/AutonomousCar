% !TEX root =  master.tex
\chapter{Steeringcontroll}\label{c:steeringcontroll}
UPDATEN!
\begin{lstlisting}[language=Python]
import RPi.GPIO as IO
import time

class Car():
    def __init__(self):
        #setup the raspberry for PWM on Pin 35
        IO.setwarnings(False)
        IO.setmode(IO.BOARD)
        IO.setup(35,IO.OUT)
        #starting pin controll
        self.steering =IO.PWM(35,50)
        self.steering.start(0)
        #set steerendpoints
        self.FULL_LEFT=10
        self.STRAIGHT=8
        self.FULL_RIGHT=6
        #get steeringrange from straightpoint
        self.LEFT=self.FULL_LEFT-self.STRAIGHT
        self.RIGHT=self.STRAIGHT-self.FULL_RIGHT

    def __del__(self):
        self.steering.stop()

    def steer(self,steeringrate):
            if steeringrate == 0:
                self.steering.ChangeDutyCycle(self.STRAIGHT)    
            elif steeringrate > 0:
                steeringrate=self.STRAIGHT + self.LEFT * steeringrate            
                if steeringrate > self.FULL_LEFT:
                    steeringrate=self.FULL_LEFT
                self.steering.ChangeDutyCycle(steeringrate)
            elif steeringrate < 0:
                steeringrate=self.STRAIGHT - self.RIGHT * abs(steeringrate)
                if steeringrate < self.FULL_RIGHT:
                    steeringrate=self.FULL_RIGHT
                self.steering.ChangeDutyCycle(steeringrate)
\end{lstlisting}

\chapter{Run\_car}\label{c:run_car}
\begin{lstlisting}[language=Python]
camera = VideoCamera(flip=False)
car = controll_car.Car()

object_detection_thread = threading.Thread(target=object_detection.detect_webcam_delay, args=(1,))
input("Hit Enter to run the car")
car.run()
object_output=None
outputcounter=0
while True:
    frame = camera.get_frame()
    try:
        if not object_detection_thread.is_alive():
            print("objectdetection started")
            object_detection_thread = threading.Thread(target=object_detection.detect_webcam_delay, args=(1,))
            object_output= object_detection_thread.start()
        if object_output == True:
            car.stop()
        elif object_output == False:
            car.run()
        frame2, canny, steering=lanedetect_steer.lane_detection(frame,"indoor")
        car.steer(steering)
    except Exception as e:
    	print(e)
        print("steeringerror")
\end{lstlisting}